<div class="container my-4 p-4 shadow rounded bg-light">

  <!-- Heading -->
  <h2 class="mb-4 fw-bold text-center heading">
    <span><i class="bi bi-bank2"></i></span>
    Bank Application Details
    <span><i class="bi bi-bank2"></i></span>
  </h2>

  <!-- ðŸ” Search / Filter / Export -->
  <div class="row mb-3 g-2 align-items-center">
    <div class="col-md-4">
      <input
        type="text"
        class="form-control"
        placeholder="Search by name..."
        [(ngModel)]="search"
        (input)="loadApplications()"
      />
    </div>

    <div class="col-md-3">
      <select
        class="form-select"
        [(ngModel)]="status"
        (change)="loadApplications()"
      >
        <option value="">All Statuses</option>
        <option value="pending">Pending</option>
        <option value="approved">Approved</option>
        <option value="rejected">Rejected</option>
        <option value="done">Done</option>
      </select>
    </div>

    <div class="col-md-2 ms-auto">
      <button class="btn btn-success w-100" (click)="exportToExcel()">
        <i class="bi bi-file-earmark-excel"></i> Export
      </button>
    </div>
  </div>

  <!-- ðŸ“‹ Table -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Full Name</th>
          <th>Phone</th>
          <th>PAN Card</th>
          <th>Income</th>
          <th>Employment</th>
          <th>Status</th>
          <th>Credit Score</th>
          <th>Assets</th>
          <th class="text-center">Actions</th>
        </tr>
      </thead>

      <tbody>
        @for (item of applicationList; track item._id) {
          <tr>
            <td>{{ item.fullName }}</td>
            <td>{{ item.mobileNumber }}</td>
            <td>{{ item.panCard }}</td>
            <td>{{ item.salary | currency:'INR' }}</td>
            <td>
              <span class="badge bg-secondary">
                {{ item.employmentStatus }}
              </span>
            </td>
            <td>
              <span
                class="badge"
                [ngClass]="{
                  'bg-warning': item.applicationStatus === 'pending',
                  'bg-success': item.applicationStatus === 'approved',
                  'bg-danger': item.applicationStatus === 'rejected'
                }"
              >
                {{ item.applicationStatus | uppercase }}
              </span>
            </td>
            <td>{{ item.creditScore }}</td>
            <td>{{ item.assets }}</td>
            <td class="text-center">
              <button
                class="btn btn-sm btn-primary me-1"
                (click)="onEdit(item._id)"
                title="Edit"
              >
                <i class="bi bi-pencil-fill"></i>
              </button>
              <button
                class="btn btn-sm btn-danger"
                (click)="deleteApplication(item._id)"
                title="Delete"
              >
                <i class="bi bi-trash-fill"></i>
              </button>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="9" class="text-center text-muted">
              No loan applications found.
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- ðŸ“„ Pagination -->
  <nav class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="page === 1">
        <button class="page-link" (click)="changePage(page - 1)">
          Previous
        </button>
      </li>

      <li class="page-item active">
        <span class="page-link">{{ page }}</span>
      </li>

      <li class="page-item" [class.disabled]="page >= totalPages">
        <button class="page-link" (click)="changePage(page + 1)">
          Next
        </button>
      </li>
    </ul>
  </nav>

</div>
